<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coco Colours - Admin Dashboard</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --black: #000000;
            --turquoise: #7dd3c0;
            --turquoise-light: #a5f3e7;
            --turquoise-dark: #5eead4;
            --gray-dark: #1f1f1f;
            --gray-medium: #4a4a4a;
            --gray-light: #9a9a9a;
            --gray-lighter: #e0e0e0;
            --white: #ffffff;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--black);
            color: var(--white);
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: var(--turquoise);
            color: var(--black);
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
        }
        
        /* Layout */
        .dashboard {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background: var(--gray-dark);
            padding: 20px;
            border-right: 1px solid var(--gray-medium);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
            z-index: 1000;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 40px;
            padding: 15px;
            background: var(--black);
            border-radius: 12px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--turquoise);
            color: var(--black);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .logo-text {
            font-size: 18px;
            font-weight: 700;
            color: var(--white);
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            margin-bottom: 5px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--gray-light);
        }
        
        .menu-item:hover {
            background: var(--gray-medium);
            color: var(--white);
        }
        
        .menu-item.active {
            background: var(--turquoise);
            color: var(--black);
        }
        
        .menu-icon {
            font-size: 20px;
        }
        
        /* Main Content */
        .main {
            flex: 1;
            margin-left: 250px;
            padding: 30px;
            width: calc(100% - 250px);
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .page-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--turquoise);
        }
        
        .header-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 12px 24px;
            border-radius: 10px;
            border: none;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .btn-primary {
            background: var(--turquoise);
            color: var(--black);
        }
        
        .btn-secondary {
            background: var(--gray-dark);
            color: var(--white);
            border: 1px solid var(--gray-medium);
        }
        
        .btn-danger {
            background: var(--danger);
            color: var(--white);
        }
        
        .btn-success {
            background: var(--success);
            color: var(--white);
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--gray-dark);
            padding: 25px;
            border-radius: 16px;
            border: 1px solid var(--gray-medium);
        }
        
        .stat-label {
            font-size: 14px;
            color: var(--gray-light);
            margin-bottom: 10px;
        }
        
        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--turquoise);
        }
        
        .stat-change {
            font-size: 12px;
            color: var(--success);
            margin-top: 5px;
        }
        
        /* Cards */
        .card {
            background: var(--gray-dark);
            border: 1px solid var(--gray-medium);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .card-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--turquoise);
        }
        
        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-pending {
            background: var(--warning);
            color: var(--black);
        }
        
        .status-approved {
            background: var(--success);
            color: var(--white);
        }
        
        .status-rejected {
            background: var(--danger);
            color: var(--white);
        }
        
        /* Request Images */
        .request-images {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .request-image {
            aspect-ratio: 1;
            background: var(--black);
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid var(--gray-medium);
        }
        
        .request-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .request-image:hover {
            border-color: var(--turquoise);
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: var(--gray-light);
        }
        
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px;
            background: var(--black);
            border: 1px solid var(--gray-medium);
            border-radius: 8px;
            color: var(--white);
            font-size: 14px;
        }
        
        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--turquoise);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        
        .info-box {
            background: var(--black);
            border: 1px solid var(--turquoise);
            border-radius: 12px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .info-box h4 {
            color: var(--turquoise);
            margin-bottom: 10px;
        }
        
        .info-box p {
            color: var(--gray-light);
            font-size: 14px;
            line-height: 1.5;
        }
        
        /* Filter Buttons */
        .filter-buttons {
            display: flex;
            gap: 10px;
        }
        
        .filter-btn {
            padding: 8px 16px;
            background: var(--gray-dark);
            color: var(--gray-light);
            border: 1px solid var(--gray-medium);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .filter-btn:hover {
            background: var(--gray-medium);
            color: var(--white);
        }
        
        .filter-btn.active {
            background: var(--turquoise);
            color: var(--black);
            border-color: var(--turquoise);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--gray-dark);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--turquoise);
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--gray-light);
            font-size: 28px;
            cursor: pointer;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }
        
        /* Image Modal */
        .image-modal {
            cursor: pointer;
        }
        
        .image-modal-content {
            max-width: 90%;
            max-height: 90vh;
        }
        
        .image-modal-content img {
            width: 100%;
            height: auto;
            border-radius: 12px;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: var(--gray-dark);
            border-radius: 16px;
            margin: 20px 0;
        }
        
        .empty-icon {
            font-size: 60px;
            margin-bottom: 20px;
            opacity: 0.3;
        }
        
        .empty-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--gray-light);
            margin-bottom: 10px;
        }
        
        .empty-text {
            color: var(--gray-medium);
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--turquoise);
            color: var(--black);
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: 600;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 3000;
            max-width: 300px;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        /* External Link */
        .external-link {
            color: var(--turquoise);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .external-link:hover {
            text-decoration: underline;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }
            
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main {
                margin-left: 0;
                width: 100%;
                padding: 60px 20px 20px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .page-title {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
    
    <div class="dashboard">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="logo">
                <div class="logo-icon">üé®</div>
                <div class="logo-text">Coco Admin</div>
            </div>
            
            <div class="menu">
                <div class="menu-item active" onclick="showPage('dashboard', this)">
                    <span class="menu-icon">üìä</span>
                    <span>Dashboard</span>
                </div>
                <div class="menu-item" onclick="showPage('requests', this)">
                    <span class="menu-icon">üìÆ</span>
                    <span>Anfragen</span>
                </div>
                <div class="menu-item" onclick="showPage('slots', this)">
                    <span class="menu-icon">‚ö°</span>
                    <span>Spontane Termine</span>
                </div>
                <div class="menu-item" onclick="showPage('events', this)">
                    <span class="menu-icon">üéâ</span>
                    <span>Events</span>
                </div>
                <div class="menu-item" onclick="showPage('push', this)">
                    <span class="menu-icon">üîî</span>
                    <span>Push-Nachrichten</span>
                </div>
                <div class="menu-item" onclick="showPage('artists', this)">
                    <span class="menu-icon">üë•</span>
                    <span>Artists</span>
                </div>
                <div class="menu-item" onclick="showPage('analytics', this)">
                    <span class="menu-icon">üìà</span>
                    <span>Analytics</span>
                </div>
                <div class="menu-item" onclick="showPage('settings', this)">
                    <span class="menu-icon">‚öôÔ∏è</span>
                    <span>Einstellungen</span>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main">
            <!-- Dashboard Page -->
            <div class="page active" id="dashboardPage">
                <div class="header">
                    <h1 class="page-title">Dashboard</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="refreshData()">üîÑ Aktualisieren</button>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Neue Anfragen</div>
                        <div class="stat-value" id="newRequests">0</div>
                        <div class="stat-change">‚Üë Heute eingegangen</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Aktive Slots</div>
                        <div class="stat-value" id="activeSlots">0</div>
                        <div class="stat-change">Verf√ºgbar</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Events</div>
                        <div class="stat-value" id="activeEvents">0</div>
                        <div class="stat-change">Geplant</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Artists</div>
                        <div class="stat-value" id="totalArtists">4</div>
                        <div class="stat-change">Aktiv</div>
                    </div>
                </div>
                
                <div class="card">
                    <h3 style="margin-bottom: 20px;">Schnellzugriff</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="showPage('slots'); openSlotModal();">+ Neuer Slot</button>
                        <button class="btn btn-primary" onclick="showPage('events'); openEventModal();">+ Neues Event</button>
                        <button class="btn btn-primary" onclick="showPage('push'); openPushModal();">üì¢ Push senden</button>
                        <a href="https://anfrage.coco-colours.de/" target="_blank" class="btn btn-secondary">üåê Zur Website</a>
                    </div>
                </div>
            </div>
            
            <!-- Requests Page -->
            <div class="page" id="requestsPage">
                <div class="header">
                    <h1 class="page-title">Buchungsanfragen</h1>
                    <div class="header-actions">
                        <select class="form-select" style="width: 200px;" onchange="filterRequests(this.value)">
                            <option value="all">Alle Anfragen</option>
                            <option value="pending">Ausstehend</option>
                            <option value="approved">Best√§tigt</option>
                            <option value="rejected">Abgelehnt</option>
                        </select>
                    </div>
                </div>
                
                <div id="requestsList"></div>
                
                <div class="empty-state" id="emptyRequests" style="display: none;">
                    <div class="empty-icon">üìÆ</div>
                    <div class="empty-title">Keine Anfragen</div>
                    <div class="empty-text">Neue Buchungsanfragen erscheinen hier</div>
                </div>
            </div>
            
            <!-- Slots Page -->
            <div class="page" id="slotsPage">
                <div class="header">
                    <h1 class="page-title">Spontane Termine</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="openSlotModal()">+ Neuer Slot</button>
                    </div>
                </div>
                
                <div class="filter-buttons" style="margin-bottom: 20px;">
                    <button class="filter-btn active" onclick="filterSlots('today')">Heute</button>
                    <button class="filter-btn" onclick="filterSlots('all')">Alle anzeigen</button>
                </div>
                
                <div id="slotsList"></div>
                
                <div class="empty-state" id="emptySlots" style="display: none;">
                    <div class="empty-icon">‚ö°</div>
                    <div class="empty-title">Keine aktiven Slots</div>
                    <div class="empty-text">Erstelle spontane Termine f√ºr deine Kunden</div>
                </div>
            </div>
            
            <!-- Events Page -->
            <div class="page" id="eventsPage">
                <div class="header">
                    <h1 class="page-title">Events & Aktionen</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="openEventModal()">+ Neues Event</button>
                        <button class="btn btn-success btn-small" onclick="createTestEvent()">Test Event</button>
                        <button class="btn btn-secondary btn-small" onclick="debugEvents()">üêõ Debug</button>
                        <button class="btn btn-danger btn-small" onclick="clearAllEvents()">üóëÔ∏è Alle l√∂schen</button>
                    </div>
                </div>
                
                <div class="filter-buttons" style="margin-bottom: 20px;">
                    <button class="filter-btn active" onclick="filterEvents('current')">Aktuelle</button>
                    <button class="filter-btn" onclick="filterEvents('all')">Alle anzeigen</button>
                </div>
                
                <div id="eventsList"></div>
                
                <div class="empty-state" id="emptyEvents" style="display: none;">
                    <div class="empty-icon">üéâ</div>
                    <div class="empty-title">Keine Events</div>
                    <div class="empty-text">Plane Events und Aktionen f√ºr deine Kunden</div>
                </div>
            </div>
            
            <!-- Push Page -->
            <div class="page" id="pushPage">
                <div class="header">
                    <h1 class="page-title">Push-Nachrichten</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="openPushModal()">üì¢ Push senden</button>
                    </div>
                </div>
                
                <div class="info-box">
                    <h4>‚ÑπÔ∏è Wie funktionieren Push-Nachrichten?</h4>
                    <p>
                        Push-Nachrichten erscheinen als <strong>Benachrichtigung im Browser/Handy</strong> wenn Nutzer die App installiert haben.<br>
                        In der App selbst werden sie als <strong>rote Punkte</strong> am Glocken-Symbol angezeigt.<br><br>
                        <strong>"Aktive Nutzer (7 Tage)"</strong> = Simulation - in einer echten App w√ºrden wir tracken, wer die App in den letzten 7 Tagen ge√∂ffnet hat.
                    </p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Abonnenten</div>
                        <div class="stat-value">247</div>
                        <div class="stat-change">‚Üë 15 diese Woche</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Gesendet heute</div>
                        <div class="stat-value" id="pushSentToday">0</div>
                        <div class="stat-change">Push-Nachrichten</div>
                    </div>
                </div>
                
                <div class="card" style="background: rgba(125, 211, 192, 0.1); border-left: 3px solid var(--turquoise); margin-bottom: 20px;">
                    <h3>üì± Wie Push-Nachrichten funktionieren</h3>
                    <div style="margin-top: 15px; line-height: 1.6;">
                        <p><strong>Wo kommen Push-Nachrichten an?</strong></p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>Als <strong>Pop-up Benachrichtigung</strong> auf dem Smartphone (wenn Nutzer Benachrichtigungen erlaubt hat)</li>
                            <li>Im <strong>Benachrichtigungscenter</strong> der App (Glocken-Symbol)</li>
                            <li>Push funktioniert auch wenn die App <strong>geschlossen</strong> ist</li>
                            <li>Nutzer m√ºssen einmalig Benachrichtigungen <strong>erlauben</strong></li>
                        </ul>
                    </div>
                </div>
                
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>Push-Verlauf</h3>
                        <div class="filter-buttons" id="pushFilter">
                            <button class="filter-btn active" onclick="filterPush('today')">Heute</button>
                            <button class="filter-btn" onclick="filterPush('all')">Alle anzeigen</button>
                        </div>
                    </div>
                    <div id="pushHistory" style="margin-top: 20px;"></div>
                </div>
            </div>
            
            <!-- Artists Page -->
            <div class="page" id="artistsPage">
                <div class="header">
                    <h1 class="page-title">Artists</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="openArtistModal()">+ Artist hinzuf√ºgen</button>
                    </div>
                </div>
                
                <div id="artistsList"></div>
            </div>
            
            <!-- Analytics Page -->
            <div class="page" id="analyticsPage">
                <div class="header">
                    <h1 class="page-title">Analytics</h1>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Anfragen diese Woche</div>
                        <div class="stat-value">23</div>
                        <div class="stat-change">‚Üë 15% vs. letzte Woche</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Conversion Rate</div>
                        <div class="stat-value">68%</div>
                        <div class="stat-change">‚Üë √úberdurchschnittlich</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">√ò Antwortzeit</div>
                        <div class="stat-value">12min</div>
                        <div class="stat-change">‚Üì 3min schneller</div>
                    </div>
                </div>
            </div>
            
            <!-- Settings Page -->
            <div class="page" id="settingsPage">
                <div class="header">
                    <h1 class="page-title">Einstellungen</h1>
                </div>
                
                <div class="card">
                    <h3>Studio-Informationen</h3>
                    <div class="form-row" style="margin-top: 20px;">
                        <div class="form-group">
                            <label class="form-label">Studio Name</label>
                            <input type="text" class="form-input" id="studioName" value="Coco Colours Tattoo Jena">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Telefon</label>
                            <input type="tel" class="form-input" id="studioPhone" value="03641 / 123456">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="studioEmail" value="info@coco-colours.de">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Adresse</label>
                            <input type="text" class="form-input" id="studioAddress" value="Musterstra√üe 123, 07743 Jena">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Website / Kontaktformular</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="url" class="form-input" id="studioWebsite" value="https://anfrage.coco-colours.de/" readonly>
                            <a href="https://anfrage.coco-colours.de/" target="_blank" class="btn btn-secondary">üîó √ñffnen</a>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="saveSettings()">Speichern</button>
                </div>
                
                <div class="card">
                    <h3>√ñffnungszeiten</h3>
                    <div class="form-row" style="margin-top: 20px;">
                        <div class="form-group">
                            <label class="form-label">Montag - Freitag</label>
                            <input type="text" class="form-input" id="hoursWeekday" value="11:00 - 19:00">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Samstag</label>
                            <input type="text" class="form-input" id="hoursSaturday" value="10:00 - 18:00">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="saveSettings()">Speichern</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Slot Modal -->
    <div class="modal" id="slotModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Spontanen Termin hinzuf√ºgen</h3>
                <button class="modal-close" onclick="closeModal('slotModal')">√ó</button>
            </div>
            
            <form id="slotForm" onsubmit="createSlot(event)">
                <div class="form-group">
                    <label class="form-label">Artist</label>
                    <select class="form-select" id="slotArtist" required>
                        <option value="">Artist w√§hlen...</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Datum</label>
                        <input type="date" class="form-input" id="slotDate" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Von (Uhrzeit)</label>
                        <input type="time" class="form-input" id="slotStartTime" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Bis (Uhrzeit)</label>
                        <input type="time" class="form-input" id="slotEndTime" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Dauer</label>
                        <select class="form-select" id="slotDuration" required>
                            <option value="1">1 Stunde</option>
                            <option value="2">2 Stunden</option>
                            <option value="3">3 Stunden</option>
                            <option value="4">4 Stunden</option>
                            <option value="5">5 Stunden</option>
                            <option value="6">6 Stunden</option>
                            <option value="7">7 Stunden</option>
                            <option value="8">8 Stunden</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Gr√∂√üe</label>
                        <select class="form-select" id="slotSize" required>
                            <option value="Klein">Klein (bis 5cm)</option>
                            <option value="Klein-Mittel">Klein-Mittel</option>
                            <option value="Mittel">Mittel (5-15cm)</option>
                            <option value="Gro√ü">Gro√ü (15-25cm)</option>
                        </select>
                    </div>
                </div>
                
                <div class="info-box">
                    <p>üí° <strong>Hinweis:</strong> Der Preis wird individuell bei der Annahme der Anfrage festgelegt und dem Kunden in der Best√§tigungsnachricht mitgeteilt.</p>
                </div>
                
                <label class="checkbox-label">
                    <input type="checkbox" id="slotUrgent">
                    <span>Als LAST MINUTE markieren</span>
                </label>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('slotModal')">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Slot erstellen</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Event Modal -->
    <div class="modal" id="eventModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Event erstellen</h3>
                <button class="modal-close" onclick="closeModal('eventModal')">√ó</button>
            </div>
            
            <form id="eventForm" onsubmit="createEvent(event)">
                <div class="form-group">
                    <label class="form-label">Event-Titel</label>
                    <input type="text" class="form-input" id="eventTitle" placeholder="z.B. Flash Day" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Start-Datum</label>
                        <input type="date" class="form-input" id="eventStartDate" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">End-Datum</label>
                        <input type="date" class="form-input" id="eventEndDate" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Start-Zeit</label>
                        <input type="time" class="form-input" id="eventStartTime" value="10:00" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">End-Zeit</label>
                        <input type="time" class="form-input" id="eventEndTime" value="18:00" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Beschreibung</label>
                    <textarea class="form-textarea" id="eventDescription" placeholder="Beschreibe das Event..." required></textarea>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('eventModal')">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Event erstellen</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Push Modal -->
    <div class="modal" id="pushModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Push-Nachricht senden</h3>
                <button class="modal-close" onclick="closeModal('pushModal')">√ó</button>
            </div>
            
            <form onsubmit="sendPushNotification(event)">
                <div class="form-group">
                    <label class="form-label">Titel</label>
                    <input type="text" class="form-input" id="pushTitle" placeholder="z.B. Neuer Slot verf√ºgbar!" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Nachricht</label>
                    <textarea class="form-textarea" id="pushMessage" placeholder="Nachrichtentext..." required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Zielgruppe</label>
                    <select class="form-select" id="pushTarget">
                        <option value="all">Alle Nutzer (247)</option>
                        <option value="active">Aktive Nutzer letzte 7 Tage (182)</option>
                        <option value="new">Neue Nutzer letzte 30 Tage (43)</option>
                    </select>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('pushModal')">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">üì¢ Senden</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Artist Modal -->
    <div class="modal" id="artistModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="artistModalTitle">Artist hinzuf√ºgen</h3>
                <button class="modal-close" onclick="closeModal('artistModal')">√ó</button>
            </div>
            
            <form onsubmit="saveArtist(event)">
                <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-input" id="artistName" placeholder="z.B. Nina" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Style</label>
                    <input type="text" class="form-input" id="artistStyle" placeholder="z.B. Watercolor ‚Ä¢ Floral" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Profilbild</label>
                    <div style="display: flex; gap: 15px; align-items: center;">
                        <div id="artistPhotoPreview" style="width: 80px; height: 80px; background: var(--gray-medium); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; overflow: hidden;">
                            <span id="artistEmojiPreview">üë§</span>
                        </div>
                        <div style="flex: 1;">
                            <input type="file" id="artistPhoto" accept="image/*" onchange="previewArtistPhoto(this)" style="display: none;">
                            <button type="button" class="btn btn-secondary" onclick="document.getElementById('artistPhoto').click()">
                                üì∑ Foto w√§hlen
                            </button>
                            <div style="margin-top: 10px;">
                                <label class="form-label">Oder Emoji verwenden:</label>
                                <input type="text" class="form-input" id="artistEmoji" placeholder="z.B. üë©‚Äçüé®" value="üë§" onchange="updateEmojiPreview(this.value)">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Beschreibung</label>
                    <textarea class="form-textarea" id="artistDescription" placeholder="Kurze Beschreibung..."></textarea>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('artistModal')">Abbrechen</button>
                    <button type="submit" class="btn btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Response Modal -->
    <div class="modal" id="responseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Auf Anfrage antworten</h3>
                <button class="modal-close" onclick="closeModal('responseModal')">√ó</button>
            </div>
            
            <div class="form-group">
                <label class="form-label">Nachricht an den Kunden (inkl. Preis bei Best√§tigung)</label>
                <textarea class="form-textarea" id="responseMessage" placeholder="z.B. Termin best√§tigt! Das Tattoo kostet 200‚Ç¨. Bitte sei 10 Min fr√ºher da..." rows="4"></textarea>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-danger" onclick="rejectRequest()">Ablehnen</button>
                <button class="btn btn-success" onclick="approveRequest()">Best√§tigen</button>
            </div>
        </div>
    </div>
    
    <!-- Image Modal -->
    <div class="modal image-modal" id="imageModal" onclick="closeModal('imageModal')">
        <div class="image-modal-content">
            <img id="modalImage" src="" alt="Vergr√∂√üerte Ansicht">
        </div>
    </div>
    
    <!-- Toast -->
    <div class="toast" id="toast"></div>
    
    <script>
        // State
        let currentPage = 'dashboard';
        let artists = [
            { id: 1, name: 'Nina', style: 'Watercolor ‚Ä¢ Floral', emoji: 'üë©‚Äçüé®' },
            { id: 2, name: 'Max', style: 'Geometric ‚Ä¢ Minimal', emoji: 'üßë‚Äçüé®' },
            { id: 3, name: 'Sophie', style: 'Fineline ‚Ä¢ Ornamental', emoji: 'üí´' },
            { id: 4, name: 'Tom', style: 'Traditional ‚Ä¢ Color', emoji: 'üéØ' }
        ];
        let bookingRequests = [];
        let spontaneousSlots = [];
        let events = []; // Initialize as empty array
        let pushHistory = [];
        let currentRequest = null;
        let editingArtist = null;
        let currentArtistPhoto = null;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
            loadArtists();
            setDefaultDates();
            
            // Display events on initial load if there are any
            if (events.length > 0) {
                displayEvents();
            }
        });
        
        // Set default dates
        function setDefaultDates() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('slotDate').value = today;
            document.getElementById('eventStartDate').value = today;
            document.getElementById('eventEndDate').value = today;
        }
        
        // Toggle Sidebar (Mobile)
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }
        
        // Show Page
        function showPage(pageName, element) {
            currentPage = pageName; // Track current page
            
            // Update menu
            if (element) {
                document.querySelectorAll('.menu-item').forEach(item => {
                    item.classList.remove('active');
                });
                element.classList.add('active');
            }
            
            // Update pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageName + 'Page').classList.add('active');
            
            // Close mobile sidebar
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('active');
            }
            
            // Load page data
            if (pageName === 'requests') displayRequests();
            if (pageName === 'slots') displaySlots();
            if (pageName === 'events') displayEvents();
            if (pageName === 'artists') displayArtists();
            if (pageName === 'push') displayPushHistory();
        }
        
        // Load All Data
        function loadAllData() {
            // Load Requests
            const savedRequests = localStorage.getItem('bookingRequests');
            if (savedRequests) {
                bookingRequests = JSON.parse(savedRequests);
            }
            
            // Load Slots
            const savedSlots = localStorage.getItem('spontaneousSlots');
            if (savedSlots) {
                spontaneousSlots = JSON.parse(savedSlots);
            }
            
            // Load Events - IMPORTANT FIX
            const savedEvents = localStorage.getItem('events');
            if (savedEvents) {
                try {
                    events = JSON.parse(savedEvents);
                    console.log('Loaded events:', events);
                } catch (e) {
                    console.error('Error loading events:', e);
                    events = [];
                }
            } else {
                console.log('No saved events found');
                events = [];
            }
            
            // Load Push History
            const savedPush = localStorage.getItem('pushHistory');
            if (savedPush) {
                pushHistory = JSON.parse(savedPush);
            }
            
            updateDashboard();
            
            // Display events if on events page
            if (currentPage === 'events') {
                displayEvents();
            }
        }
        
        // Load Artists
        function loadArtists() {
            const savedArtists = localStorage.getItem('artists');
            if (savedArtists) {
                artists = JSON.parse(savedArtists);
            }
            updateArtistSelects();
        }
        
        // Update Artist Selects
        function updateArtistSelects() {
            const select = document.getElementById('slotArtist');
            select.innerHTML = '<option value="">Artist w√§hlen...</option>';
            artists.forEach(artist => {
                select.innerHTML += `<option value="${artist.name}">${artist.name} - ${artist.style}</option>`;
            });
        }
        
        // Update Dashboard
        function updateDashboard() {
            const pendingRequests = bookingRequests.filter(r => r.status === 'pending').length;
            document.getElementById('newRequests').textContent = pendingRequests;
            document.getElementById('activeSlots').textContent = spontaneousSlots.length;
            document.getElementById('activeEvents').textContent = events.length;
            document.getElementById('totalArtists').textContent = artists.length;
            
            // Count push sent today
            const today = new Date().toDateString();
            const sentToday = pushHistory.filter(p => {
                return new Date(p.timestamp).toDateString() === today;
            }).length;
            const pushTodayEl = document.getElementById('pushSentToday');
            if (pushTodayEl) pushTodayEl.textContent = sentToday;
        }
        
        // Display Requests
        function displayRequests(filter = 'all') {
            const container = document.getElementById('requestsList');
            
            let filtered = bookingRequests;
            if (filter !== 'all') {
                filtered = bookingRequests.filter(r => r.status === filter);
            }
            
            if (filtered.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-icon">üìÆ</div><div class="empty-title">Keine Anfragen</div></div>';
                return;
            }
            
            container.innerHTML = filtered.map(request => `
                <div class="card">
                    <div class="card-header">
                        <div>
                            <h3 class="card-title">${request.name}</h3>
                            <div style="color: var(--gray-light); margin-top: 5px;">
                                ${request.slot.date} ‚Ä¢ ${request.slot.time} Uhr ‚Ä¢ ${request.slot.artist}
                            </div>
                        </div>
                        <div class="status-badge status-${request.status}">
                            ${request.status === 'pending' ? 'Ausstehend' : 
                              request.status === 'approved' ? 'Best√§tigt' : 'Abgelehnt'}
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <strong>Telefon:</strong> ${request.phone}<br>
                        <strong>Email:</strong> ${request.email || '-'}<br>
                        <strong>Slot-Dauer:</strong> ${request.slot.duration || '-'}<br>
                        <strong>Tattoo-Gr√∂√üe:</strong> ${request.slot.size || '-'}<br>
                        <strong>Tattoo-Wunsch:</strong> ${request.description}
                        ${request.message ? `<br><strong>Nachricht:</strong> ${request.message}` : ''}
                    </div>
                    
                    ${request.images && request.images.length > 0 ? `
                        <div>
                            <strong>Referenzbilder:</strong>
                            <div class="request-images">
                                ${request.images.map((img, index) => `
                                    <div class="request-image" onclick="showImage('${img}')">
                                        <img src="${img}" alt="Bild ${index + 1}">
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                    
                    ${request.adminMessage ? `
                        <div style="background: var(--black); padding: 15px; border-radius: 8px; margin-top: 15px;">
                            <strong>Deine Antwort:</strong><br>
                            ${request.adminMessage}
                        </div>
                    ` : ''}
                    
                    ${request.status === 'pending' ? `
                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button class="btn btn-danger" onclick="openResponseModal(${request.id}, 'reject')">
                                Ablehnen
                            </button>
                            <button class="btn btn-success" onclick="openResponseModal(${request.id}, 'approve')">
                                Best√§tigen
                            </button>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }
        
        // Show Image in Modal
        function showImage(imageSrc) {
            document.getElementById('modalImage').src = imageSrc;
            document.getElementById('imageModal').classList.add('active');
        }
        
        // Display Slots
        function displaySlots() {
            const container = document.getElementById('slotsList');
            
            let filteredSlots = spontaneousSlots;
            
            // Apply filter
            if (currentFilters.slots === 'today') {
                const today = new Date().toDateString();
                filteredSlots = spontaneousSlots.filter(slot => {
                    // Check if slot date contains "Heute" or is today's date
                    return slot.date.toLowerCase().includes('heute') || 
                           slot.urgent === true;
                });
            }
            
            if (filteredSlots.length === 0) {
                container.innerHTML = `<div class="empty-state">
                    <div class="empty-icon">‚ö°</div>
                    <div class="empty-title">${currentFilters.slots === 'today' ? 'Heute keine Slots' : 'Keine aktiven Slots'}</div>
                </div>`;
                return;
            }
            
            container.innerHTML = filteredSlots.map(slot => {
                const timeDisplay = slot.startTime && slot.endTime ? 
                    `${slot.startTime} - ${slot.endTime} Uhr` : 
                    `${slot.time} Uhr`;
                
                return `
                <div class="card">
                    <div class="card-header">
                        <div>
                            <h3 class="card-title" style="color: var(--turquoise);">
                                üìÖ ${slot.date} ‚Ä¢ üïê ${timeDisplay}
                            </h3>
                            <div style="margin-top: 8px;">
                                <strong>${slot.artist}</strong> ‚Ä¢ ${slot.style || ''}
                            </div>
                        </div>
                        ${slot.urgent ? '<span class="status-badge status-pending">LAST MINUTE</span>' : ''}
                    </div>
                    <div style="margin: 15px 0; display: flex; gap: 20px;">
                        <div>
                            <span style="color: var(--gray-light);">Dauer:</span><br>
                            <strong>${slot.duration}</strong>
                        </div>
                        <div>
                            <span style="color: var(--gray-light);">Gr√∂√üe:</span><br>
                            <strong>${slot.size}</strong>
                        </div>
                        <div>
                            <span style="color: var(--gray-light);">Status:</span><br>
                            <strong style="color: var(--turquoise);">Verf√ºgbar</strong>
                        </div>
                    </div>
                    <div style="color: var(--gray-light); font-size: 12px; margin-bottom: 10px;">
                        Erstellt: ${new Date(slot.id).toLocaleString('de-DE')}
                    </div>
                    <button class="btn btn-danger btn-small" onclick="deleteSlot(${slot.id})">L√∂schen</button>
                </div>
            `).join('');
        }
        
        // Display Events
        function displayEvents() {
            const container = document.getElementById('eventsList');
            
            let filteredEvents = events;
            
            // Apply filter
            if (currentFilters.events === 'current') {
                const today = new Date();
                filteredEvents = events.filter(event => {
                    // Check if event is current or future
                    if (event.startDate) {
                        return new Date(event.startDate) >= today;
                    }
                    // If no date, assume it's current
                    return true;
                });
            }
            
            if (filteredEvents.length === 0) {
                container.innerHTML = `<div class="empty-state">
                    <div class="empty-icon">üéâ</div>
                    <div class="empty-title">${currentFilters.events === 'current' ? 'Keine aktuellen Events' : 'Keine Events'}</div>
                </div>`;
                return;
            }
            
            container.innerHTML = filteredEvents.map(event => `
                <div class="card">
                    <h3 class="card-title">${event.title}</h3>
                    <div style="margin: 15px 0;">
                        <strong>Zeitraum:</strong> ${event.dateRange || event.date || 'Kein Datum'}<br>
                        ${event.timeRange ? `<strong>Uhrzeit:</strong> ${event.timeRange}<br>` : ''}
                        <div style="margin-top: 10px;">${event.description}</div>
                    </div>
                    <button class="btn btn-danger btn-small" onclick="deleteEvent(${event.id})">L√∂schen</button>
                </div>
            `).join('');
            
            // Also update dashboard count
            updateDashboard();
        }
        
        // Display Artists
        function displayArtists() {
            const container = document.getElementById('artistsList');
            
            container.innerHTML = artists.map(artist => `
                <div class="card">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="width: 60px; height: 60px; background: var(--turquoise); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; overflow: hidden;">
                            ${artist.photo ? 
                                `<img src="${artist.photo}" style="width: 100%; height: 100%; object-fit: cover;">` : 
                                `<span>${artist.emoji || 'üë§'}</span>`
                            }
                        </div>
                        <div style="flex: 1;">
                            <h3 class="card-title">${artist.name}</h3>
                            <div>${artist.style}</div>
                            ${artist.description ? `<div style="margin-top: 5px; color: var(--gray-light); font-size: 14px;">${artist.description}</div>` : ''}
                        </div>
                        <div>
                            <button class="btn btn-secondary btn-small" onclick="editArtist(${artist.id})">Bearbeiten</button>
                            <button class="btn btn-danger btn-small" onclick="deleteArtist(${artist.id})">L√∂schen</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // Display Push History
        // Filter states
        let currentFilters = {
            push: 'today',
            slots: 'today',
            events: 'current'
        };
        
        function displayPushHistory() {
            const container = document.getElementById('pushHistory');
            
            let filteredPush = pushHistory;
            
            // Apply filter
            if (currentFilters.push === 'today') {
                const today = new Date().toDateString();
                filteredPush = pushHistory.filter(push => {
                    return new Date(push.timestamp).toDateString() === today;
                });
            }
            
            if (filteredPush.length === 0) {
                container.innerHTML = `<div style="color: var(--gray-light);">
                    ${currentFilters.push === 'today' ? 'Heute noch keine Push-Nachrichten gesendet' : 'Noch keine Push-Nachrichten gesendet'}
                </div>`;
                return;
            }
            
            container.innerHTML = filteredPush.map(push => `
                <div style="padding: 15px; background: var(--black); border-radius: 8px; margin-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <strong>${push.title}</strong>
                        <small style="color: var(--gray-light);">${new Date(push.timestamp).toLocaleString('de-DE')}</small>
                    </div>
                    <div>${push.message}</div>
                    <div style="margin-top: 10px; color: var(--gray-light);">
                        Gesendet an: ${push.targetLabel}
                    </div>
                </div>
            `).join('');
        }
        
        // Filter functions
        function filterPush(filter) {
            currentFilters.push = filter;
            document.querySelectorAll('#pushFilter .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            displayPushHistory();
        }
        
        function filterSlots(filter) {
            currentFilters.slots = filter;
            document.querySelectorAll('#slotsPage .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            displaySlots();
        }
        
        function filterEvents(filter) {
            currentFilters.events = filter;
            document.querySelectorAll('#eventsPage .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            displayEvents();
        }
        
        // Open Modals
        function openSlotModal() {
            document.getElementById('slotModal').classList.add('active');
        }
        
        function openEventModal() {
            document.getElementById('eventModal').classList.add('active');
        }
        
        function openPushModal() {
            document.getElementById('pushModal').classList.add('active');
        }
        
        function openArtistModal() {
            document.getElementById('artistModalTitle').textContent = 'Artist hinzuf√ºgen';
            document.getElementById('artistName').value = '';
            document.getElementById('artistStyle').value = '';
            document.getElementById('artistEmoji').value = 'üë§';
            document.getElementById('artistDescription').value = '';
            document.getElementById('artistPhoto').value = '';
            document.getElementById('artistPhotoPreview').innerHTML = '<span id="artistEmojiPreview">üë§</span>';
            editingArtist = null;
            currentArtistPhoto = null;
            document.getElementById('artistModal').classList.add('active');
        }
        
        function openResponseModal(requestId) {
            currentRequest = bookingRequests.find(r => r.id === requestId);
            document.getElementById('responseModal').classList.add('active');
        }
        
        // Close Modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            // Reset artist photo if closing artist modal
            if (modalId === 'artistModal') {
                currentArtistPhoto = null;
                editingArtist = null;
            }
        }
        
        // Create Slot
        function createSlot(event) {
            event.preventDefault();
            
            const artistName = document.getElementById('slotArtist').value;
            const artist = artists.find(a => a.name === artistName);
            
            const slotDate = document.getElementById('slotDate').value;
            const slotStartTime = document.getElementById('slotStartTime').value;
            const slotEndTime = document.getElementById('slotEndTime').value;
            const slotDuration = document.getElementById('slotDuration').value;
            
            const slot = {
                id: Date.now(),
                artist: artistName,
                avatar: artist ? artist.emoji : 'üë§', // Use emoji as avatar
                photo: artist ? artist.photo : null, // Store photo separately
                style: artist ? artist.style : '',
                date: formatDate(slotDate),
                time: slotStartTime, // Keep for backwards compatibility
                startTime: slotStartTime,
                endTime: slotEndTime,
                duration: slotDuration + ' Stunde' + (slotDuration > 1 ? 'n' : ''),
                size: document.getElementById('slotSize').value,
                price: 'Nach Absprache',
                urgent: document.getElementById('slotUrgent').checked,
                createdAt: new Date().toISOString()
            };
            
            spontaneousSlots.push(slot);
            localStorage.setItem('spontaneousSlots', JSON.stringify(spontaneousSlots));
            
            displaySlots();
            updateDashboard();
            closeModal('slotModal');
            showToast('‚úÖ Slot erfolgreich erstellt!');
            
            // Reset form
            document.getElementById('slotForm').reset();
            document.getElementById('slotDate').valueAsDate = new Date();
        }
        
        // Create Event
        function createEvent(event) {
            event.preventDefault();
            
            const title = document.getElementById('eventTitle').value;
            const startDateInput = document.getElementById('eventStartDate').value;
            const endDateInput = document.getElementById('eventEndDate').value;
            const startTime = document.getElementById('eventStartTime').value;
            const endTime = document.getElementById('eventEndTime').value;
            const description = document.getElementById('eventDescription').value;
            
            // Format date range
            let dateRange;
            const startDate = new Date(startDateInput);
            const endDate = new Date(endDateInput);
            
            if (startDateInput === endDateInput) {
                // Single day
                dateRange = formatDate(startDateInput);
            } else {
                // Multiple days
                dateRange = `${formatDate(startDateInput)} - ${formatDate(endDateInput)}`;
            }
            
            const newEvent = {
                id: Date.now(),
                title: title,
                dateRange: dateRange,
                date: dateRange, // For backward compatibility
                timeRange: `${startTime} - ${endTime} Uhr`,
                description: description,
                startDate: startDateInput,
                endDate: endDateInput,
                startTime: startTime,
                endTime: endTime
            };
            
            // Add to events array
            events.push(newEvent);
            
            // Save to localStorage
            localStorage.setItem('events', JSON.stringify(events));
            
            // Force reload events from storage to verify
            const savedEvents = localStorage.getItem('events');
            if (savedEvents) {
                events = JSON.parse(savedEvents);
            }
            
            // Update display immediately
            displayEvents();
            updateDashboard();
            
            // Close modal
            closeModal('eventModal');
            
            // Show success message
            showToast('‚úÖ Event erfolgreich erstellt!');
            
            // Reset form
            document.getElementById('eventForm').reset();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('eventStartDate').value = today;
            document.getElementById('eventEndDate').value = today;
            
            console.log('Event created:', newEvent);
            console.log('All events:', events);
        }
        
        // Send Push Notification
        function sendPushNotification(event) {
            event.preventDefault();
            
            const target = document.getElementById('pushTarget').value;
            let targetLabel = document.getElementById('pushTarget').options[document.getElementById('pushTarget').selectedIndex].text;
            
            const push = {
                id: Date.now(),
                title: document.getElementById('pushTitle').value,
                message: document.getElementById('pushMessage').value,
                target: target,
                targetLabel: targetLabel,
                timestamp: new Date().toISOString()
            };
            
            pushHistory.unshift(push);
            localStorage.setItem('pushHistory', JSON.stringify(pushHistory));
            
            displayPushHistory();
            updateDashboard();
            closeModal('pushModal');
            showToast('üì¢ Push-Nachricht gesendet!');
        }
        
        // Preview Artist Photo
        function previewArtistPhoto(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentArtistPhoto = e.target.result;
                    document.getElementById('artistPhotoPreview').innerHTML = `<img src="${e.target.result}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        // Update Emoji Preview
        function updateEmojiPreview(emoji) {
            if (!currentArtistPhoto) {
                document.getElementById('artistPhotoPreview').innerHTML = `<span id="artistEmojiPreview">${emoji || 'üë§'}</span>`;
            }
        }
        
        // Save Artist
        function saveArtist(event) {
            event.preventDefault();
            
            const artistData = {
                name: document.getElementById('artistName').value,
                style: document.getElementById('artistStyle').value,
                emoji: document.getElementById('artistEmoji').value || 'üë§',
                photo: currentArtistPhoto || null,
                description: document.getElementById('artistDescription').value
            };
            
            if (editingArtist) {
                // Update existing
                const index = artists.findIndex(a => a.id === editingArtist);
                artists[index] = { ...artists[index], ...artistData };
            } else {
                // Add new
                artistData.id = Date.now();
                artists.push(artistData);
            }
            
            localStorage.setItem('artists', JSON.stringify(artists));
            loadArtists();
            displayArtists();
            closeModal('artistModal');
            showToast(editingArtist ? '‚úÖ Artist aktualisiert!' : '‚úÖ Artist hinzugef√ºgt!');
        }
        
        // Edit Artist
        function editArtist(id) {
            const artist = artists.find(a => a.id === id);
            if (!artist) return;
            
            document.getElementById('artistModalTitle').textContent = 'Artist bearbeiten';
            document.getElementById('artistName').value = artist.name;
            document.getElementById('artistStyle').value = artist.style;
            document.getElementById('artistEmoji').value = artist.emoji || 'üë§';
            document.getElementById('artistDescription').value = artist.description || '';
            
            // Handle photo preview
            if (artist.photo) {
                currentArtistPhoto = artist.photo;
                document.getElementById('artistPhotoPreview').innerHTML = `<img src="${artist.photo}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
            } else {
                currentArtistPhoto = null;
                document.getElementById('artistPhotoPreview').innerHTML = `<span id="artistEmojiPreview">${artist.emoji || 'üë§'}</span>`;
            }
            
            editingArtist = id;
            document.getElementById('artistModal').classList.add('active');
        }
        
        // Delete Functions
        function deleteSlot(id) {
            if (confirm('Slot wirklich l√∂schen?')) {
                spontaneousSlots = spontaneousSlots.filter(s => s.id !== id);
                localStorage.setItem('spontaneousSlots', JSON.stringify(spontaneousSlots));
                displaySlots();
                updateDashboard();
                showToast('üóëÔ∏è Slot gel√∂scht');
            }
        }
        
        function deleteEvent(id) {
            if (confirm('Event wirklich l√∂schen?')) {
                events = events.filter(e => e.id !== id);
                localStorage.setItem('events', JSON.stringify(events));
                displayEvents();
                updateDashboard();
                showToast('üóëÔ∏è Event gel√∂scht');
            }
        }
        
        function deleteArtist(id) {
            if (confirm('Artist wirklich l√∂schen?')) {
                artists = artists.filter(a => a.id !== id);
                localStorage.setItem('artists', JSON.stringify(artists));
                loadArtists();
                displayArtists();
                updateDashboard();
                showToast('üóëÔ∏è Artist gel√∂scht');
            }
        }
        
        // Approve/Reject Request
        function approveRequest() {
            if (!currentRequest) return;
            
            currentRequest.status = 'approved';
            currentRequest.adminMessage = document.getElementById('responseMessage').value || 'Termin best√§tigt! Wir freuen uns auf dich!';
            
            localStorage.setItem('bookingRequests', JSON.stringify(bookingRequests));
            
            // Update customer's requests
            const customerRequests = JSON.parse(localStorage.getItem('myRequests') || '[]');
            const customerRequest = customerRequests.find(r => r.id === currentRequest.id);
            if (customerRequest) {
                customerRequest.status = 'approved';
                customerRequest.adminMessage = currentRequest.adminMessage;
                localStorage.setItem('myRequests', JSON.stringify(customerRequests));
            }
            
            displayRequests();
            updateDashboard();
            closeModal('responseModal');
            showToast('‚úÖ Anfrage best√§tigt!');
        }
        
        function rejectRequest() {
            if (!currentRequest) return;
            
            currentRequest.status = 'rejected';
            currentRequest.adminMessage = document.getElementById('responseMessage').value || 'Leider k√∂nnen wir diesen Termin nicht anbieten.';
            
            localStorage.setItem('bookingRequests', JSON.stringify(bookingRequests));
            
            // Update customer's requests
            const customerRequests = JSON.parse(localStorage.getItem('myRequests') || '[]');
            const customerRequest = customerRequests.find(r => r.id === currentRequest.id);
            if (customerRequest) {
                customerRequest.status = 'rejected';
                customerRequest.adminMessage = currentRequest.adminMessage;
                localStorage.setItem('myRequests', JSON.stringify(customerRequests));
            }
            
            displayRequests();
            updateDashboard();
            closeModal('responseModal');
            showToast('‚ùå Anfrage abgelehnt');
        }
        
        // Filter Requests
        function filterRequests(filter) {
            displayRequests(filter);
        }
        
        // Format Date
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const today = new Date();
            
            if (date.toDateString() === today.toDateString()) {
                return 'Heute';
            }
            
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            if (date.toDateString() === tomorrow.toDateString()) {
                return 'Morgen';
            }
            
            // Return formatted date like "23. November"
            const day = date.getDate();
            const months = ['Januar', 'Februar', 'M√§rz', 'April', 'Mai', 'Juni', 
                           'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'];
            const month = months[date.getMonth()];
            
            return `${day}. ${month}`;
        }
        
        // Save Settings
        function saveSettings() {
            const settings = {
                name: document.getElementById('studioName').value,
                phone: document.getElementById('studioPhone').value,
                email: document.getElementById('studioEmail').value,
                address: document.getElementById('studioAddress').value,
                website: document.getElementById('studioWebsite').value,
                hoursWeekday: document.getElementById('hoursWeekday').value,
                hoursSaturday: document.getElementById('hoursSaturday').value
            };
            
            localStorage.setItem('studioSettings', JSON.stringify(settings));
            showToast('‚úÖ Einstellungen gespeichert!');
        }
        
        // Refresh Data
        function refreshData() {
            loadAllData();
            showToast('üîÑ Daten aktualisiert');
        }
        
        // Create Test Event
        function createTestEvent() {
            const testEvent = {
                id: Date.now(),
                title: 'Test Event ' + new Date().toLocaleTimeString('de-DE'),
                dateRange: 'Heute',
                date: 'Heute',
                timeRange: '10:00 - 18:00 Uhr',
                description: 'Dies ist ein Test-Event zum √úberpr√ºfen der Funktionalit√§t.',
                startDate: new Date().toISOString().split('T')[0],
                endDate: new Date().toISOString().split('T')[0],
                startTime: '10:00',
                endTime: '18:00'
            };
            
            events.push(testEvent);
            localStorage.setItem('events', JSON.stringify(events));
            
            displayEvents();
            updateDashboard();
            showToast('‚úÖ Test-Event erstellt!');
            
            console.log('Test event created:', testEvent);
        }
        
        // Clear All Events
        function clearAllEvents() {
            if (confirm('Wirklich ALLE Events l√∂schen? Das kann nicht r√ºckg√§ngig gemacht werden!')) {
                events = [];
                localStorage.setItem('events', JSON.stringify(events));
                displayEvents();
                updateDashboard();
                showToast('üóëÔ∏è Alle Events gel√∂scht');
            }
        }
        
        // Debug Events
        function debugEvents() {
            const storedEvents = localStorage.getItem('events');
            console.log('=== EVENT DEBUG ===');
            console.log('Events in memory:', events);
            console.log('Events in localStorage:', storedEvents);
            if (storedEvents) {
                try {
                    const parsed = JSON.parse(storedEvents);
                    console.log('Parsed events:', parsed);
                } catch (e) {
                    console.error('Error parsing events:', e);
                }
            }
            
            // Show in alert for easy viewing
            const message = `Events im Speicher: ${events.length}\n` +
                           `Events in localStorage: ${storedEvents ? JSON.parse(storedEvents).length : 0}\n\n` +
                           `Details siehe Browser-Konsole (F12)`;
            alert(message);
        }
        
        // Show Toast
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // Auto refresh
        setInterval(() => {
            loadAllData();
            // Refresh current page
            if (currentPage === 'events') displayEvents();
            if (currentPage === 'slots') displaySlots();
            if (currentPage === 'requests') displayRequests();
        }, 3000); // Check every 3 seconds for updates
    </script>
</body>
</html>