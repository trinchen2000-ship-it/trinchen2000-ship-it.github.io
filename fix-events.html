<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Event Fix Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        
        .box {
            background: #2d2d2d;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        button {
            background: #40E0D0;
            color: #1a1a1a;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }
        
        button:hover {
            opacity: 0.8;
        }
        
        pre {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        
        .success {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .error {
            color: #f44336;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>üõ†Ô∏è Coco App Event Debugging & Fix Tool</h1>
    
    <div class="box">
        <h2>1. Aktuelle Events im localStorage:</h2>
        <pre id="currentEvents"></pre>
    </div>
    
    <div class="box">
        <h2>2. Probleme:</h2>
        <div id="problems"></div>
    </div>
    
    <div class="box">
        <h2>3. Aktionen:</h2>
        <button onclick="checkEvents()">üîç Events pr√ºfen</button>
        <button onclick="fixEvents()">üîß Events reparieren</button>
        <button onclick="clearEvents()">üóëÔ∏è Alle Events l√∂schen</button>
        <button onclick="createTestEvent()">‚ûï Test-Event erstellen</button>
    </div>
    
    <div class="box">
        <h2>4. Ergebnis:</h2>
        <div id="result"></div>
    </div>

    <script>
        // Initial check
        window.onload = () => {
            checkEvents();
        };
        
        function checkEvents() {
            const events = JSON.parse(localStorage.getItem('events') || '[]');
            const currentEventsDiv = document.getElementById('currentEvents');
            const problemsDiv = document.getElementById('problems');
            
            currentEventsDiv.textContent = JSON.stringify(events, null, 2);
            
            let problems = [];
            let hasOldFormat = false;
            let hasNewFormat = false;
            
            events.forEach((event, index) => {
                // Check for old format (date, time, location)
                if (event.date || event.time || event.location) {
                    hasOldFormat = true;
                    problems.push(`Event #${index + 1} (${event.title || 'Unbenannt'}) hat altes Format mit 'date'/'time'/'location' Feldern`);
                }
                
                // Check for new format (startDate, endDate, startTime, endTime)
                if (event.startDate && event.endDate && event.startTime && event.endTime) {
                    hasNewFormat = true;
                } else if (!event.date && !event.time) {
                    problems.push(`Event #${index + 1} (${event.title || 'Unbenannt'}) fehlen wichtige Felder`);
                }
            });
            
            if (problems.length === 0) {
                problemsDiv.innerHTML = '<span class="success">‚úÖ Keine Probleme gefunden! Alle Events haben das richtige Format.</span>';
            } else {
                problemsDiv.innerHTML = '<span class="error">‚ö†Ô∏è Gefundene Probleme:</span><ul>' + 
                    problems.map(p => `<li>${p}</li>`).join('') + '</ul>';
            }
            
            if (hasOldFormat && hasNewFormat) {
                problemsDiv.innerHTML += '<p>‚ö†Ô∏è Gemischte Formate gefunden!</p>';
            }
        }
        
        function fixEvents() {
            const events = JSON.parse(localStorage.getItem('events') || '[]');
            const resultDiv = document.getElementById('result');
            let fixed = 0;
            
            const fixedEvents = events.map(event => {
                // If event has old format, convert it
                if (event.date || event.time) {
                    fixed++;
                    return {
                        id: event.id || Date.now() + Math.random(),
                        title: event.title || 'Unbenanntes Event',
                        startDate: event.date || event.startDate || new Date().toISOString().split('T')[0],
                        endDate: event.date || event.endDate || new Date().toISOString().split('T')[0],
                        startTime: event.time ? event.time.split('-')[0].trim() : (event.startTime || '10:00'),
                        endTime: event.time ? (event.time.split('-')[1] || '18:00').trim() : (event.endTime || '18:00'),
                        description: event.description || '',
                        created: event.created || new Date().toISOString()
                    };
                }
                // Event already has correct format
                return event;
            });
            
            // Save fixed events
            localStorage.setItem('events', JSON.stringify(fixedEvents));
            
            resultDiv.innerHTML = `<span class="success">‚úÖ ${fixed} Events repariert!</span>`;
            
            // Reload display
            setTimeout(() => {
                checkEvents();
            }, 500);
        }
        
        function clearEvents() {
            if (confirm('Wirklich alle Events l√∂schen?')) {
                localStorage.setItem('events', '[]');
                document.getElementById('result').innerHTML = '<span class="success">‚úÖ Alle Events gel√∂scht!</span>';
                checkEvents();
            }
        }
        
        function createTestEvent() {
            const events = JSON.parse(localStorage.getItem('events') || '[]');
            
            const testEvent = {
                id: Date.now(),
                title: 'Test Flash Day ' + new Date().toLocaleDateString('de-DE'),
                startDate: new Date().toISOString().split('T')[0],
                endDate: new Date().toISOString().split('T')[0],
                startTime: '10:00',
                endTime: '18:00',
                description: 'Test Event zum Pr√ºfen der Funktionalit√§t',
                created: new Date().toISOString()
            };
            
            events.push(testEvent);
            localStorage.setItem('events', JSON.stringify(events));
            
            document.getElementById('result').innerHTML = '<span class="success">‚úÖ Test-Event erstellt!</span>';
            checkEvents();
        }
    </script>
</body>
</html>
